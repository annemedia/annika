ann.cl.reg.regset={pub:"",salut:"",email:"",country:"",pic:""},ann.cl.reg.makeReg=async function(e,t){let n=document.querySelector(".reg-wrap");n&&n.remove(),ann.cl.onload.regOnLoad=async function(){document.querySelector("reg").setAttribute("data-before","Registration")};var a=await ann.getCountries();let o=ann.declareVars(12);o.v1="reg-wrap fadeOut hide",o.v3=o.v5="o-v",o.v6=o.v7="custominput w-218px",o.v8="customselect scrollbar",o.v9="annikabutton regbtn",o.v10="close2 mt-20",o.v11="heart fadeOut hide";let l=ann.json2array(o),r=ann.declareVars(12);r.v6=async function(e,t){ann.validateSalutation(t)},r.v9=async function(e,t){if(t.preventDefault(),0===function(e){let t=e.path[2].querySelector(".croppie-container");return t.croppie.img?(ann.cl.reg.regset.pic=t.croppie.img,1):(ann.modal("MISSING PICTURE","Please upload your profile picture and confirm its position.",1,e.path[2]),0)}(t))return;if(0===await ann.validateSalutation(t))return;if(0===await ann.validateEmail(t)&&(await ann.modalResponse(),0===ann.get.modal.response))return;if(0===ann.validateCountry(t))return;let n=t.path[2].querySelector(".discardimage"),a=t.path[2].querySelector(".customlabel");ann.show(n,!1),ann.show(a,!1);let o=t.path[2].querySelector("form");ann.show(o,!1),t.path[2].parentElement.setAttribute("data-before","Welcome "+ann.cl.reg.regset.salut);let l=document.querySelector("postreg");ann.toggleFade(l)},r.v10=function(e,t){let n=t.target.closest(".reg-wrap");n&&ann.toggleFade(n)};let i=ann.json2array(r);return ann.Subroutine("reg+ann.cl.onload.regOnLoad",["div_y","reg_y","div_y","croppie_120_120","$3_form_y_@submit","input_text_@blur","$5_input_email","$5_select","$5_button","$2_span","$2_canvas",async function(){ann.cl.onload.postRegOnLoad=async function(){ann.waitForGlobal("bitcoin",(function(){let e=document.getElementsByClassName("datakey")[0],t=localStorage.getItem("wif");if(!t){t=ann.newNeuron().WIF}e.innerHTML=t,localStorage.removeItem("wif"),ann.copyToClipboard()}))};let n=ann.declareVars(8);n.v1="hide fadeOut",n.v2="mt-10",n.v3="datakeyinfo inlineb",n.v4="datakey copycontent",n.v5="datakeyinfo",n.v7=n.v8="iambutton w-50";let a=ann.json2array(n),o=ann.declareVars(8);o.v7=o.v8=async function(n,a){var o=a.path[1].querySelectorAll("button"),l=!1;o[1].id===n&&(l=!0);for(var r in o)"object"==typeof o[r]&&(o[r].disabled=!0);if(!a.path[2].querySelector(".copycontent").classList.contains("off")){for(var r in ann.modal("ACTION REQUIRED","Make a copy of your Data Key, keep it safe.",1,a.path[3]),o)"object"==typeof o[r]&&(o[r].disabled=!1);return}await ann.cl.reg.register(ann.cl.reg.regset,a.path[2].parentElement,l);let i=document.querySelector("reg"),u=i.querySelector("postreg");var s=i.getElementsByClassName("croppie-inner")[0];ann.show(u,!1),ann.show(s.parentElement.parentElement,!1);var c=document.getElementById("heart");ann.isVisible(c)||ann.toggleFade(c);let d=document.getElementById("regsuccess");d||(d=document.createElement("p"),d.id="regsuccess",d.style.fontSize="1.5rem",d.style.padding="20px",d.innerHTML="REGISTRATION SUCCESS",c.append(d),setTimeout((function(){ann.toggleFade(c),setTimeout((function(){if(ann.show(c,!1),e)e(n,a);else{let e=document.getElementsByClassName("reg-wrap")[0];ann.toggleFade(e),setTimeout((function(){e.remove()}),2500)}}),500)}),2500));t&&t(n,a)};let l=ann.json2array(o);return ann.Subroutine("postreg+ann.cl.onload.postRegOnLoad",["$2_postreg_y","h3","$1_div_y","$1_div_y","$1_div_y","$1_div_x","button","$6_button"],[null,"Your Key Your Data","You are the bearer of the Data Key. The key is unique to the holder. Its use satisfies the proof of your identity and enables the holder to retrieve and edit user data.<br><br>Copy and paste the key into a safe place or write it down for safekeeping. <b>Unless desired, never share it with anyone, and do not lose it.</b> We do not have a copy and cannot recover it.","PlacEHo1dERkey77WfUwy99UbZAL3vhmaFxMYzdnBJ544XhgBLaS","Nevertheless, you may encrypt your Data Key and keep the key safely in our custody. No one, including anyone with access to our servers, will be able to see or use your key, but you can retrieve and decrypt it using a secret password of your choosing.",null,"MY CUSTODY ONLY","OUR SAFEKEEPING"],[...a],[...l])}],[null,null,null,null,null,"label_Salutation","label_Email (optional)",[a,"Country",0,"3+2"],"REGISTER","X",ann.heart,null],[...l],[...i])},ann.validateCountry=function(e,t){var n,a;t?(a=t,n=t):(a=e.path[2],n=e.path[1]);let o=n.querySelector(".selected").getAttribute("value");if(!o||0==o)return ann.modal("MISSING DATA","Please choose a country of your influence.",1,a),0;ann.cl.reg.regset.country=o},ann.validateEmail=async function(e,t,n,a,o){var l,r;return l=t||e.path[1].querySelectorAll('input:not([type="hidden"]')[1],r=n||e.path[2],l&&l.value&&l.value.includes("@")&&l.value.includes(".")&&!(!l.value.length>6)?(ann.cl.reg.regset.email=l.value,1):(o?ann.modal("INVALID EMAIL",o,a,r):ann.modal("INVALID EMAIL","If you choose not to include your email, we will be unable to contact you. Would you still like to register without providing your email address?",2,r),0)},ann.validateSalutation=async function(e,t,n,a){var o,l;e.preventDefault(),o=t||e.path[1].querySelector('input:not([type="hidden"]'),l=n||e.path[2];var r,i=o.value;return i&&i.trim().length>=0&&i.trim().length<2||!i?(ann.modal("MISSING DATA","Your salutation is missing or is too short. Please enter your salutation.",1,l),0):(i&&(i=i.trim()),i&&""!==i&&(r=await ann.fetch("getSalut",{salut:i},"POST")),1!==r&&""!==i?(ann.modal("UNAVAILABLE","Sorry, "+i+" is taken. Please choose another salutation.",1,l),o.value="",e.stopImmediatePropagation(),0):(ann.cl.reg.regset.salut=o.value,1))},ann.cl.reg.register=async function(e,t,n=!1){if(!e)return;if((t=t)||(t=document.getElementsByTagName("reg")[0]),!t)return;n=n?2:1,ann.modal("SESSION PASSWORD","<span class='inlineb'>Enter &nbsp;<hoverwrap><u>session password</u>.<hovertip>This password will be used to encrypt & protect the key in your browser's cache. We cannot recover this password. If you lose it, you can clear the cache and use your Data Key to set a new password.</hovertip></hoverwrap></span>",1,t,n);var a=document.getElementsByClassName("datakey")[0].innerHTML,o=ann.getPublicAddressFromWif(a);if(localStorage.setItem("pub",o),ann.cl.reg.regset.pub=o,await ann.modalResponse(),0!=ann.get.modal.response){var l=localStorage.getItem("pass");localStorage.removeItem("pass");var r=localStorage.getItem("safekeeping");if(localStorage.removeItem("safekeeping"),l){let e=await ann.fetch("createID",ann.cl.reg.regset,"POST");if(e.salut&&e.salut[0]&&e.salut[0].includes("has already been taken"))return void ann.modal("UNAVAILABLE","Sorry, "+ann.cl.reg.regset.salut+" is taken. Please use different salutation.",1);if(e.out&&e.out[0]&&e.out[0].includes("field is required."))return;localStorage.removeItem("out-done");var i,u=await ann.encryptRoutine(a,l,e[0]);r&&(i=(await ann.encryptRoutine(a,r)).item),localStorage.setItem("api-token",e[1]),localStorage.setItem("enwif",u.item);let t=u.ik,n=u.count,o=await ann.sha256(e[0]),s={pub:ann.cl.reg.regset.pub,ik:t,count:n,msg:o,safe:i};await ann.fetch("updateID",s,"POST")}}},ann.cl.auth.authModule=async function(){return ann.requireObject(ann.cl.auth.callback,1e4).then((function(o){return ann.keep.isChecked=!1,ann.cl.onload.patronAuth=async function(){let e=localStorage.getItem("enwif");if(e&&e.length>52){let t=document.querySelector("auth"),n=t.querySelector("input");n.setAttribute("value",e),t.querySelector("input[type=checkbox]").checked=!0,ann.createListener(n,"keydown",(function(e,t){13===t.keyCode&&n.blur()}))}},ann.Subroutine("authuser+ann.cl.onload.patronAuth",["div_y","auth_x","div_y","input_text_@blur","$2_div_y","input_checkbox_@click","$2_span","$2_span"],[null,null,null,"label_Patron Key",null,"label_KEEP","&#10227;","&#x2717;"],["dyn-w","dyn-w slideUp",null,null,"w-25px p-5 o-v",null,"reload","authclose"],[null,null,null,t,null,e,n,a],[null,null,null,o,null,null,null,null])}));async function e(e,t){if(t.path[0].checked)ann.keep.isChecked=!0;else{if(localStorage.getItem("enwif")){if(ann.modal("CONFIRMATION","Your encrypted datakey is securely kept in browser's cache. Do you want to remove it?",2),await ann.modalResponse(),0==ann.get.modal.response){return void(document.querySelector("auth").querySelector("input[type=checkbox]").checked=!0)}localStorage.removeItem("enwif")}ann.keep.isChecked=!1}}async function t(e,t,n){var a=t.path[0].getAttribute("value")&&52===t.path[0].getAttribute("value").length?t.path[0].getAttribute("value"):t.path[0].value;if(a&&52===a.length){let e=ann.getPublicAddressFromWif(a);if(e){let o={pub:e};ann.fetch("getIK",o,"POST").then((async function(e){if(e.ik.includes("not found"))ann.modal("NOT FOUND","<span class='inlineb'>Our server could not find your identity Please enter correct Data Key.</span>",1);else if(e.count&&e.ik){var o=await ann.decryptRoutine(a,!0,e.ik,e.count);if(o.pub&&o.item&&52===o.item.length&&o.msg){let r=localStorage.getItem("auth");if(ann.keep.isChecked&&"true"!==r){if(ann.modal("SESSION PASSWORD","Enter session password",2,null,1),await ann.modalResponse(),0==ann.get.modal.response)return;var l=localStorage.getItem("pass");let e=await ann.encryptRoutine(a,l);localStorage.removeItem("pass"),localStorage.setItem("enwif",e.item)}else ann.keep.isChecked||localStorage.removeItem("enwif");let i=await ann.sha256(t.path[0].value);t.path[0].value=await ann.sha256(t.path[0].value),t.path[0].setAttribute("value",i);let u=document.querySelector("autharea");u&&u.parentElement&&u.parentElement.remove(),n(o,e.ik,a,e.count),localStorage.removeItem("auth")}}}))}else ann.modal("INVALID KEY","<span class='inlineb'>Please enter correct Data Key</span>",1)}}async function n(e,t){localStorage.removeItem("auth"),await ann.cl.auth.handleAuth()}async function a(e,t){let n=document.querySelector("autharea");n&&n.parentElement&&(ann.toggleSlide(n.parentElement),setTimeout((function(){n.parentElement.remove()}),2500))}},ann.cl.auth.handleAuth=async function(e=!1){ann.require("auth").then((async function(t){var n=t;setTimeout((async function(){ann.isVisible(n)||ann.toggleSlide(n)}),500);let a=n.querySelector("input"),o=localStorage.getItem("enwif")?localStorage.getItem("enwif"):void 0;if(o&&o.length>52){if(a.setAttribute("value",o),ann.modal("SESSION PASSWORD","Enter session password",2,null,1),await ann.modalResponse(),0==ann.get.modal.response)return void a.removeAttribute("value");let e=localStorage.getItem("pass");localStorage.removeItem("pass");let t=await ann.decryptRoutine(o,e);t&&t.item&&52===t.item.length?(localStorage.setItem("auth","true"),ann.keep.isChecked=!0,a.setAttribute("value",t.item),a.focus(),a.blur()):(a.removeAttribute("value"),ann.cl.auth.handleAuth())}else e||ann.modal("MISSING DATAKEY","No datakey has been found. Please enter your datakey.",1)}))};